import{p as I}from"./p5.min-BSfcF2sv.js";import{a as v,o as f,b as N,c as S,d as w,e as R,f as k,_ as V,g as M,G as C,n as T,w as E,h as P,S as F}from"./index-BGeJOtze.js";import{i as b,a as L}from"./index.es-BqIYh0BY.js";import{b as B}from"./sketch_utils-Cd7mJY-m.js";import{E as x}from"./Effect-C5gDVUBC.js";import{L as j}from"./LFO-BuAGx3Ev.js";import{M as A,A as q}from"./MeterBase-XOrtjUOA.js";class g extends v{constructor(){super(f(g.getDefaults(),arguments,["type"])),this.name="Noise",this._source=null;const t=f(g.getDefaults(),arguments,["type"]);this._playbackRate=t.playbackRate,this.type=t.type,this._fadeIn=t.fadeIn,this._fadeOut=t.fadeOut}static getDefaults(){return Object.assign(v.getDefaults(),{fadeIn:0,fadeOut:0,playbackRate:1,type:"white"})}get type(){return this._type}set type(t){if(N(t in O,"Noise: invalid type: "+t),this._type!==t&&(this._type=t,this.state==="started")){const s=this.now();this._stop(s),this._start(s)}}get playbackRate(){return this._playbackRate}set playbackRate(t){this._playbackRate=t,this._source&&(this._source.playbackRate.value=t)}_start(t){const s=O[this._type];this._source=new S({url:s,context:this.context,fadeIn:this._fadeIn,fadeOut:this._fadeOut,loop:!0,onended:()=>this.onstop(this),playbackRate:this._playbackRate}).connect(this.output),this._source.start(this.toSeconds(t),Math.random()*(s.duration-.001))}_stop(t){this._source&&(this._source.stop(this.toSeconds(t)),this._source=null)}get fadeIn(){return this._fadeIn}set fadeIn(t){this._fadeIn=t,this._source&&(this._source.fadeIn=this._fadeIn)}get fadeOut(){return this._fadeOut}set fadeOut(t){this._fadeOut=t,this._source&&(this._source.fadeOut=this._fadeOut)}_restart(t){this._stop(t),this._start(t)}dispose(){return super.dispose(),this._source&&this._source.disconnect(),this}}const p=44100*5,D=2,u={brown:null,pink:null,white:null},O={get brown(){if(!u.brown){const e=[];for(let t=0;t<D;t++){const s=new Float32Array(p);e[t]=s;let n=0;for(let a=0;a<p;a++){const r=Math.random()*2-1;s[a]=(n+.02*r)/1.02,n=s[a],s[a]*=3.5}}u.brown=new w().fromArray(e)}return u.brown},get pink(){if(!u.pink){const e=[];for(let t=0;t<D;t++){const s=new Float32Array(p);e[t]=s;let n,a,r,c,o,i,h;n=a=r=c=o=i=h=0;for(let d=0;d<p;d++){const l=Math.random()*2-1;n=.99886*n+l*.0555179,a=.99332*a+l*.0750759,r=.969*r+l*.153852,c=.8665*c+l*.3104856,o=.55*o+l*.5329522,i=-.7616*i-l*.016898,s[d]=n+a+r+c+o+i+h+l*.5362,s[d]*=.11,h=l*.115926}}u.pink=new w().fromArray(e)}return u.pink},get white(){if(!u.white){const e=[];for(let t=0;t<D;t++){const s=new Float32Array(p);e[t]=s;for(let n=0;n<p;n++)s[n]=Math.random()*2-1}u.white=new w().fromArray(e)}return u.white}};class m extends R{constructor(){super(f(m.getDefaults(),arguments,["channels"])),this.name="Merge";const t=f(m.getDefaults(),arguments,["channels"]);this._merger=this.output=this.input=this.context.createChannelMerger(t.channels)}static getDefaults(){return Object.assign(R.getDefaults(),{channels:2})}dispose(){return super.dispose(),this._merger.disconnect(),this}}class y extends x{constructor(){super(f(y.getDefaults(),arguments,["decay"])),this.name="Reverb",this._convolver=this.context.createConvolver(),this.ready=Promise.resolve();const t=f(y.getDefaults(),arguments,["decay"]);this._decay=t.decay,this._preDelay=t.preDelay,this.generate(),this.connectEffect(this._convolver)}static getDefaults(){return Object.assign(x.getDefaults(),{decay:1.5,preDelay:.01})}get decay(){return this._decay}set decay(t){t=this.toSeconds(t),k(t,.001),this._decay=t,this.generate()}get preDelay(){return this._preDelay}set preDelay(t){t=this.toSeconds(t),k(t,0),this._preDelay=t,this.generate()}generate(){return V(this,void 0,void 0,function*(){const t=this.ready,s=new M(2,this._decay+this._preDelay,this.context.sampleRate),n=new g({context:s}),a=new g({context:s}),r=new m({context:s});n.connect(r,0,0),a.connect(r,0,1);const c=new C({context:s}).toDestination();r.connect(c),n.start(0),a.start(0),c.gain.setValueAtTime(0,0),c.gain.setValueAtTime(1,this._preDelay),c.gain.exponentialApproachValueAtTime(0,this._preDelay,this.decay);const o=s.render();return this.ready=o.then(T),yield t,this._convolver.buffer=(yield o).get(),this})}dispose(){return super.dispose(),this._convolver.disconnect(),this}}class _ extends A{constructor(){super(f(_.getDefaults(),arguments,["smoothing"])),this.name="Meter",this._rms=0;const t=f(_.getDefaults(),arguments,["smoothing"]);this.input=this.output=this._analyser=new q({context:this.context,size:256,type:"waveform",channels:t.channels}),this.smoothing=t.smoothing,this.normalRange=t.normalRange}static getDefaults(){return Object.assign(A.getDefaults(),{smoothing:.8,normalRange:!1,channels:1})}getLevel(){return E("'getLevel' has been changed to 'getValue'"),this.getValue()}getValue(){const t=this._analyser.getValue(),n=(this.channels===1?[t]:t).map(a=>{const r=a.reduce((o,i)=>o+i*i,0),c=Math.sqrt(r/a.length);return this._rms=Math.max(c,this._rms*this.smoothing),this.normalRange?this._rms:P(this._rms)});return this.channels===1?n[0]:n}get channels(){return this._analyser.channels}dispose(){return super.dispose(),this._analyser.dispose(),this}}const z=e=>{let t=!1,s=[],n,a;e.setup=()=>{e.createCanvas(e.windowWidth,e.windowHeight),B()},e.windowResized=()=>{e.resizeCanvas(e.windowWidth,e.windowHeight)},e.draw=()=>{if(e.background(0),t)for(let o of s)o.run(),e.translate(0,e.height/s.length);else e.fill(255),e.noStroke(),e.textAlign(e.CENTER),e.text("Click to start sound",e.width/2,e.height/2)},e.mousePressed=()=>{t||(t=!0,r())};function r(){let o="major pentatonic";a=new C;let i=new y({wet:.5,decay:30});a.connect(i),i.toDestination(),n=b.get("C3 "+o).notes,n=n.concat(b.get("C4 "+o).notes),n=n.concat(b.get("C5 "+o).notes),L.shuffle(n);for(let h=0;h<n.length;h++)s[h]=new c(.85+h*1/60,n[h])}class c{constructor(i,h){this.frequency=i*.5,this.note=h,this.lfo=new j(this.frequency),this.lfo.start(1),this.meter=new _,this.meter.normalRange=!0,this.lfo.connect(this.meter),this.synth=new F,this.synth.connect(a),this.previousPosition=0}run(){let i=.5-this.meter.getValue(0),h=e.map(i,-.5,.5,100,e.width-100),d=i>0&&this.previousPosition<0,l=i<0&&this.previousPosition>0;(d||l)&&this.synth.triggerAttackRelease(this.note,"8n"),this.previousPosition=i,e.fill(255),e.stroke(255),e.line(h,50,e.width/2,0),e.ellipse(h,50,25,25)}}};new I(z);
