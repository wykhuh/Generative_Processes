import{p as j}from"./p5.min-BSfcF2sv.js";import{e as _,o as u,P as z,r as w,G as V,D as A,T as m,S as I}from"./index-BGeJOtze.js";import{i as M,b as C}from"./index.es-BqIYh0BY.js";import{P as W,A as S,F as H}from"./FFT-F1tRpMxB.js";import{E as F}from"./Effect-C5gDVUBC.js";import{L}from"./Loop-BIzYltV2.js";import"./MeterBase-XOrtjUOA.js";class f extends _{constructor(){super(u(f.getDefaults(),arguments,["delayTime","maxDelay"])),this.name="Delay";const n=u(f.getDefaults(),arguments,["delayTime","maxDelay"]),s=this.toSeconds(n.maxDelay);this._maxDelay=Math.max(s,this.toSeconds(n.delayTime)),this._delayNode=this.input=this.output=this.context.createDelay(s),this.delayTime=new z({context:this.context,param:this._delayNode.delayTime,units:"time",value:n.delayTime,minValue:0,maxValue:this.maxDelay}),w(this,"delayTime")}static getDefaults(){return Object.assign(_.getDefaults(),{delayTime:0,maxDelay:1})}get maxDelay(){return this._maxDelay}dispose(){return super.dispose(),this._delayNode.disconnect(),this.delayTime.dispose(),this}}class O extends F{constructor(n){super(n),this.name="FeedbackEffect",this._feedbackGain=new V({context:this.context,gain:n.feedback,units:"normalRange"}),this.feedback=this._feedbackGain.gain,w(this,"feedback"),this.effectReturn.chain(this._feedbackGain,this.effectSend)}static getDefaults(){return Object.assign(F.getDefaults(),{feedback:.125})}dispose(){return super.dispose(),this._feedbackGain.dispose(),this.feedback.dispose(),this}}class y extends O{constructor(){super(u(y.getDefaults(),arguments,["delayTime","feedback"])),this.name="FeedbackDelay";const n=u(y.getDefaults(),arguments,["delayTime","feedback"]);this._delayNode=new f({context:this.context,delayTime:n.delayTime,maxDelay:n.maxDelay}),this.delayTime=this._delayNode.delayTime,this.connectEffect(this._delayNode),w(this,"delayTime")}static getDefaults(){return Object.assign(O.getDefaults(),{delayTime:.25,maxDelay:1})}dispose(){return super.dispose(),this._delayNode.dispose(),this.delayTime.dispose(),this}}const $=e=>{let n=-10,s=!1,l=M.get("C4 major").notes,h=[],p=0,T=0,g,x;e.setup=()=>{e.createCanvas(e.windowWidth,e.windowHeight);for(let a=0;a<l.length;a++){let t=[];t[0]=r(a,l),t[1]=r(a+2,l),t[2]=r(a+4,l),t[3]=r(a+6,l),h.push(t)}},e.windowResized=()=>{e.resizeCanvas(e.windowWidth,e.windowHeight)},e.draw=()=>{if(e.background(0),s){e.background(0),e.stroke(255);let a=e.min(e.width,e.height)/2;e.translate(e.width/2,e.height/2);let t=x.getValue(0);for(let i=0;i<t.length;i++){e.push();let o=e.map(i,0,t.length,0,e.TWO_PI);e.rotate(o);let d=t[i],c=e.map(d,-100,0,0,a);e.point(0,c),e.pop()}}else e.background(0,25),e.fill(255),e.noStroke(),e.textAlign(e.CENTER),e.text("Click to start sound",e.width/2,e.height/2)},e.mousePressed=()=>{s||(s=!0,E())};function E(){A.volume.value=n,m.bpm.value=60,g=new W(S,{envelope:{attack:1,release:2},volume:-6}),g.toDestination();let a=new b([0,1,2,3,4,3,2],"xx-x--"),t=new b([4,3,2,1,0],"-x-xx-x","8n","16n",7),i=new y("8n.",.5);a.synth.connect(i),t.synth.connect(i),i.toDestination();let o=new I;o.oscillator.type="fattriangle",o.toDestination(),o.triggerAttack(r(-14,l)),x=new H(1024),A.connect(x),m.schedule(k,"1"),m.start()}function k(a){p=T;let t=e.floor(e.random(1,4))+"m";g.triggerAttackRelease(h[p],t,a),T=e.floor(e.random(h.length)),m.schedule(k,"+"+t)}function r(a,t){let i=t.length,o=G(a,i),d=t[o],D=C.octave(t[0])+e.floor(a/i);return C.pitchClass(d)+D}function G(a,t){return(a%t+t)%t}class b{constructor(t,i,o="8n",d="8n",c=0){this.tempo=o,this.duration=d,this.offset=c,this.synth=new S,this.motif=v(t),this.rhythm=v(i),this.loop=new L(D=>{let N=h[p],P=this.motif.next().value;if(this.rhythm.next().value=="x"){let R=r(P+this.offset,N);this.synth.triggerAttackRelease(R,this.duration,D)}},this.tempo),this.loop.start(1)}}function*v(a){let t=0;for(;;){let i=a[t%a.length];t++,yield i}}};new j($);
